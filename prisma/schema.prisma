

// generator client {
//   provider = "prisma-client-js"
// }

// datasource db {
//   provider = "postgresql"
//   url      = env("DATABASE_URL")
// }

// // ============================================================================
// // ENUMS (Type Definitions)
// // ============================================================================

// enum Role {
//   SUPER_ADMIN
//   ADMIN
//   ACCOUNTANT
//   PRODUCTION_MANAGER
//   SALES_MANAGER
//   STORE_KEEPER
//   HR
//   USER
// }

// enum CurrencyCode {
//   USD
//   EUR
//   NGN
//   GBP
//   // Add other currencies as needed
// }

// enum AssetStatus {
//   ACTIVE
//   IN_REPAIR
//   LOST
//   DAMAGED
//   DISPOSED
// }

// enum ExpenseStatus {
//   PENDING
//   APPROVED
//   REJECTED
//   PAID
// }

// enum ExpensePaymentMethod {
//   CASH
//   TRANSFER
//   CHEQUE
//   POS
//   MOBILE_MONEY
// }

// enum RecurringInterval {
//   DAILY
//   WEEKLY
//   MONTHLY
//   YEARLY
// }

// enum InvoiceStatus {
//   DRAFT
//   SENT
//   PARTIALLY_PAID
//   PAID
//   OVERDUE
//   VOID
// }

// enum PaymentMethod {
//   CASH
//   BANK_TRANSFER
//   CHECK
//   CREDIT_FROM_OVERPAYMENT
// }

// enum ProductType {
//   RAW_MATERIAL
//   WORK_IN_PROGRESS
//   FINISHED_GOOD
//   SERVICE
// }

// enum AccountType {
//   ASSET
//   LIABILITY
//   EQUITY
//   REVENUE
//   EXPENSE
// }

// enum DeprMethod {
//   STRAIGHT_LINE
//   DECLINING_BALANCE
//   UNITS_OF_PRODUCTION
// }

// enum EmployeeStatus {
//   ACTIVE
//   SUSPENDED
//   TERMINATED
//   ON_LEAVE
// }

// // ============================================================================
// // 1. AUTHENTICATION & CORE SETTINGS
// // ============================================================================

// model User {
//   id           String   @id @default(cuid())
//   email        String   @unique
//   name         String?
//   passwordHash String
//   role         Role     @default(USER)
//   isActive     Boolean  @default(true) // Restored as requested
//   createdAt    DateTime @default(now())
//   updatedAt    DateTime @updatedAt

//   // RELATIONS
//   employeeProfile  Employee?

//   // Actions performed by this user
//   approvedExpenses  Expense[]          @relation("ExpenseApprover")
//   purchaseOrders    PurchaseOrder[]    @relation("POCreator")
//   journalEntries    JournalEntry[]     @relation("EntryCreator")
//   announcements     Announcement[]
//   productionReports ProductionReport[] @relation("ReportCreator") // Added for Production Tracking

//   @@map("users")
// }

// model Currency {
//   id             String       @id @default(cuid())
//   code           CurrencyCode @unique
//   name           String
//   symbol         String
//   isBaseCurrency Boolean      @default(false)
//   isActive       Boolean      @default(true)
//   createdAt      DateTime     @default(now())
//   updatedAt      DateTime     @updatedAt

//   // RELATIONS
//   exchangeRates ExchangeRate[]
//   invoices      SalesInvoice[]
//   payments      CustomerPayment[]
//   expenses      Expense[]
//   employees     Employee[]
//   payrolls      Payroll[]

//   @@map("currencies")
// }

// model ExchangeRate {
//   id         String   @id @default(cuid())
//   currencyId String
//   rate       Decimal  @db.Decimal(18, 6)
//   date       DateTime @default(now())

//   currency Currency @relation(fields: [currencyId], references: [id], onDelete: Cascade)

//   @@index([currencyId, date])
//   @@map("exchange_rates")
// }

// // ============================================================================
// // 2. HR & PAYROLL MANAGEMENT
// // ============================================================================

// model Employee {
//   id String @id @default(cuid())

//   // Basic Details
//   employeeNumber String    @unique // e.g., EMP-001
//   firstName      String
//   lastName       String
//   email          String?   @unique
//   phone          String?
//   address        String?   @db.Text
//   dateOfBirth    DateTime?
  
//   // Job Details
//   position String
//   hireDate DateTime
//   status   EmployeeStatus @default(ACTIVE)

//   // Compensation
//   basicSalary Decimal @db.Decimal(18, 2)
//   currencyId  String

//   // Link to System User
//   userId String? @unique

//   createdAt DateTime @default(now())
//   updatedAt DateTime @updatedAt

//   departmentId    String
//   department      Department     @relation(fields: [departmentId], references: [id])
//   subDepartmentId String?
//   subDepartment   SubDepartment? @relation(fields: [subDepartmentId], references: [id])

//   // RELATIONS
//   currency   Currency            @relation(fields: [currencyId], references: [id])
//   user       User?               @relation(fields: [userId], references: [id])
//   assignedAssets Asset[]
//   payrolls   Payroll[]
//   statusLogs EmployeeStatusLog[]

//   @@map("employees")
// }

// model EmployeeStatusLog {
//   id         String         @id @default(cuid())
//   employeeId String
//   employee   Employee       @relation(fields: [employeeId], references: [id], onDelete: Cascade)
//   oldStatus  EmployeeStatus
//   newStatus  EmployeeStatus
//   changedAt  DateTime       @default(now())

//   @@map("employee_status_logs")
// }

// model Department {
//   id             String          @id @default(cuid())
//   name           String          @unique
//   subDepartments SubDepartment[]
//   employees      Employee[]
//   createdAt      DateTime        @default(now())
//   updatedAt      DateTime        @updatedAt

//   @@map("departments")
// }

// model SubDepartment {
//   id           String     @id @default(cuid())
//   name         String
//   departmentId String
//   department   Department @relation(fields: [departmentId], references: [id], onDelete: Cascade)
//   employees    Employee[]
//   createdAt    DateTime   @default(now())
//   updatedAt    DateTime   @updatedAt

//   @@unique([name, departmentId])
//   @@map("sub_departments")
// }

// model Payroll {
//   id             String   @id @default(cuid())
//   employeeId     String
//   payPeriodStart DateTime
//   payPeriodEnd   DateTime

//   basicSalary     Decimal @db.Decimal(18, 2)
//   totalAllowances Decimal @db.Decimal(18, 2) @default(0)
//   totalDeductions Decimal @db.Decimal(18, 2) @default(0)
//   netPay          Decimal @db.Decimal(18, 2)

//   currencyId  String
//   status      String    @default("DRAFT")
//   paymentDate DateTime?

//   createdAt DateTime @default(now())
//   updatedAt DateTime @updatedAt

//   employee   Employee           @relation(fields: [employeeId], references: [id])
//   currency   Currency           @relation(fields: [currencyId], references: [id])
//   components PayrollComponent[]

//   @@map("payrolls")
// }

// model PayrollComponent {
//   id        String  @id @default(cuid())
//   payrollId String
//   name      String
//   type      String
//   amount    Decimal @db.Decimal(18, 2)

//   payroll Payroll @relation(fields: [payrollId], references: [id], onDelete: Cascade)

//   @@map("payroll_components")
// }

// // ============================================================================
// // 3. ASSET MANAGEMENT
// // ============================================================================

// model Asset {
//   id String @id @default(cuid())

//   // Identification
//   assetTag     String  @unique
//   name         String
//   category     String
//   description  String? @db.Text
//   serialNumber String? @unique

//   // Acquisition
//   purchaseDate DateTime
//   purchaseCost Decimal  @db.Decimal(18, 2)
//   vendor       String?
//   supplierId   String?

//   // Warranty
//   warrantyStart        DateTime?
//   warrantyEnd          DateTime?
//   warrantyPeriodMonths Int?

//   // State & Location
//   status     AssetStatus @default(ACTIVE)
//   condition  String?
//   location   String?
//   department String?

//   // Assignment
//   assignedToEmployeeId String?

//   // Maintenance
//   lastMaintenance DateTime?
//   nextMaintenance DateTime?

//   // Disposal
//   disposed       Boolean   @default(false)
//   disposalDate   DateTime?
//   disposalReason String?   @db.Text

//   createdAt DateTime @default(now())
//   updatedAt DateTime @updatedAt

//   // RELATIONS
//   assignedTo         Employee?          @relation(fields: [assignedToEmployeeId], references: [id])
//   supplier           Supplier?          @relation(fields: [supplierId], references: [id])
//   maintenanceRecords AssetMaintenance[]

//   @@map("assets")
// }

// model AssetMaintenance {
//   id              String   @id @default(cuid())
//   assetId         String
//   maintenanceDate DateTime
//   description     String   @db.Text
//   cost            Decimal  @db.Decimal(18, 2)
//   performedBy     String?
//   createdAt       DateTime @default(now())

//   asset Asset @relation(fields: [assetId], references: [id], onDelete: Cascade)

//   @@map("asset_maintenances")
// }

// // ============================================================================
// // 4. PRODUCTION & INVENTORY
// // ============================================================================

// model Product {
//   id          String      @id @default(cuid())
//   code        String      @unique // Main internal code
//   sku         String?     // Added to sync with live DB (if different from code)
//   name        String
//   type        ProductType @default(FINISHED_GOOD)
//   brand       String?
//   description String?

//   // Inventory
//   stockOnHand  Int @default(0)
//   reorderLevel Int @default(10)

//   // Financials
//   costPrice    Decimal @db.Decimal(18, 2)
//   sellingPrice Decimal @db.Decimal(18, 2)

//   createdAt DateTime @default(now())
//   updatedAt DateTime @updatedAt

//   // RELATIONS
//   inventoryMovements InventoryMovement[]
//   invoiceItems       SalesInvoiceItem[]
//   poItems            PurchaseOrderItem[]
//   productionReports  ProductionReport[]

//   // BOM
//   bomParent BillOfMaterial[] @relation("BOMParent")
//   bomChild  BillOfMaterial[] @relation("BOMComponent")

//   @@map("products")
// }

// model BillOfMaterial {
//   id          String  @id @default(cuid())
//   parentId    String
//   componentId String
//   quantity    Decimal @db.Decimal(12, 4)

//   parent    Product @relation("BOMParent", fields: [parentId], references: [id])
//   component Product @relation("BOMComponent", fields: [componentId], references: [id])

//   @@unique([parentId, componentId])
//   @@map("bill_of_materials")
// }

// model InventoryMovement {
//   id          String   @id @default(cuid())
//   productId   String
//   type        String // SALE, PURCHASE, PRODUCTION, ADJUSTMENT
//   quantity    Int
//   referenceId String?
//   date        DateTime @default(now())

//   product Product @relation(fields: [productId], references: [id])

//   @@index([productId, date])
//   @@map("inventory_movements")
// }

// model ProductionReport {
//   id          String   @id @default(cuid())
//   batchNumber String   @unique
//   date        DateTime
//   shift       String // DAY, NIGHT

//   productId    String
//   totalQty     Int // Tracks "Quantity Produced"
//   qualifiedQty Int
//   rejectedQty  Int @default(0) // Tracks "Waste/Defects"

//   // Detailed Reporting (New Requirements)
//   rawMaterialsUsed Json?   // Stores materials used in this batch
//   staffId          String? // Link to User responsible
  
//   notes     String?  @db.Text
//   createdAt DateTime @default(now())
//   updatedAt DateTime @updatedAt

//   product   Product            @relation(fields: [productId], references: [id])
//   staff     User?              @relation("ReportCreator", fields: [staffId], references: [id])
//   defects   ProductionDefect[]

//   @@map("production_reports")
// }

// model ProductionDefect {
//   id                 String @id @default(cuid())
//   productionReportId String
//   defectType         String
//   quantity           Int

//   productionReport ProductionReport @relation(fields: [productionReportId], references: [id], onDelete: Cascade)

//   @@map("production_defects")
// }

// // ============================================================================
// // 5. SALES, CUSTOMERS & DEBTORS
// // ============================================================================

// model Customer {
//   id      String  @id @default(cuid())
//   name    String
//   code    String? @unique
//   email   String?
//   phone   String?
//   address String? @db.Text

//   currentBalance Decimal  @db.Decimal(18, 2) @default(0)
//   creditLimit    Decimal? @db.Decimal(18, 2)

//   createdAt DateTime @default(now())
//   updatedAt DateTime @updatedAt

//   invoices SalesInvoice[]
//   payments CustomerPayment[]

//   @@map("customers")
// }

// model CustomerPayment {
//   id            String   @id @default(cuid())
//   paymentNumber String   @unique
//   customerId    String
//   date          DateTime @default(now())

//   amount       Decimal @db.Decimal(18, 2)
//   unusedAmount Decimal @db.Decimal(18, 2)

//   method     PaymentMethod
//   reference  String?
//   currencyId String

//   customer     Customer             @relation(fields: [customerId], references: [id])
//   currency     Currency             @relation(fields: [currencyId], references: [id])
//   applications PaymentApplication[]

//   @@map("customer_payments")
// }

// model PaymentApplication {
//   id            String   @id @default(cuid())
//   paymentId     String
//   invoiceId     String
//   amountApplied Decimal  @db.Decimal(18, 2)
//   appliedAt     DateTime @default(now())

//   payment CustomerPayment @relation(fields: [paymentId], references: [id])
//   invoice SalesInvoice    @relation(fields: [invoiceId], references: [id])

//   @@map("payment_applications")
// }

// // ============================================================================
// // 6. PURCHASING & SUPPLIERS
// // ============================================================================

// model Supplier {
//   id      String  @id @default(cuid())
//   name    String
//   email   String?
//   phone   String?
//   balance Decimal @db.Decimal(18, 2) @default(0)

//   createdAt DateTime @default(now())

//   purchaseOrders PurchaseOrder[]
//   assets         Asset[]
//   expenses       Expense[]

//   @@map("suppliers")
// }

// model PurchaseOrder {
//   id         String   @id @default(cuid())
//   poNumber   String   @unique
//   supplierId String
//   date       DateTime @default(now())
//   status     String   @default("DRAFT")

//   totalAmount Decimal @db.Decimal(18, 2)
//   createdById String

//   supplier Supplier            @relation(fields: [supplierId], references: [id])
//   creator  User                @relation("POCreator", fields: [createdById], references: [id])
//   items    PurchaseOrderItem[]

//   @@map("purchase_orders")
// }

// model PurchaseOrderItem {
//   id              String  @id @default(cuid())
//   purchaseOrderId String
//   productId       String
//   quantity        Int
//   unitCost        Decimal @db.Decimal(18, 2)
//   total           Decimal @db.Decimal(18, 2)

//   purchaseOrder PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)
//   product       Product       @relation(fields: [productId], references: [id])

//   @@map("purchase_order_items")
// }

// // ============================================================================
// // 7. EXPENSE TRACKING
// // ============================================================================

// model Expense {
//   id String @id @default(cuid())

//   expenseCode String  @unique
//   title       String
//   description String? @db.Text
//   category    String

//   amount        Decimal              @db.Decimal(18, 2)
//   currencyId    String
//   paymentMethod ExpensePaymentMethod

//   vendor     String?
//   supplierId String?

//   incurredDate DateTime
//   department   String?
//   project      String?

//   status       ExpenseStatus @default(PENDING)
//   approvedById String?

//   attachmentUrl String?

//   recurring         Boolean            @default(false)
//   recurringInterval RecurringInterval?

//   notes     String?  @db.Text
//   createdAt DateTime @default(now())
//   updatedAt DateTime @updatedAt

//   currency     Currency      @relation(fields: [currencyId], references: [id])
//   approvedBy   User?         @relation("ExpenseApprover", fields: [approvedById], references: [id])
//   supplier     Supplier?     @relation(fields: [supplierId], references: [id])
//   journalEntry JournalEntry? @relation(fields: [journalEntryId], references: [id])

//   journalEntryId String? @unique

//   @@map("expenses")
// }

// // ============================================================================
// // 8. ACCOUNTING (General Ledger)
// // ============================================================================

// model ChartOfAccount {
//   id              String   @id @default(cuid())
//   code            String   @unique
//   name            String
//   type            AccountType
//   isSystemAccount Boolean  @default(false)

//   entries JournalEntryLine[]

//   @@map("chart_of_accounts")
// }

// model JournalEntry {
//   id          String   @id @default(cuid())
//   entryNumber String   @unique
//   date        DateTime
//   description String?
//   reference   String?
//   posted      Boolean  @default(false)
//   createdById String?

//   createdAt DateTime @default(now())

//   creator      User?              @relation("EntryCreator", fields: [createdById], references: [id])
//   lines        JournalEntryLine[]
//   salesInvoice SalesInvoice?
//   expense      Expense?

//   @@map("journal_entries")
// }

// model JournalEntryLine {
//   id             String  @id @default(cuid())
//   journalEntryId String
//   accountId      String

//   debit  Decimal @db.Decimal(18, 2) @default(0)
//   credit Decimal @db.Decimal(18, 2) @default(0)

//   account      ChartOfAccount @relation(fields: [accountId], references: [id])
//   journalEntry JournalEntry   @relation(fields: [journalEntryId], references: [id], onDelete: Cascade)

//   @@map("journal_entry_lines")
// }

// // ============================================================================
// // 9. SALES INVOICING (Updated for Logistics & Tax)
// // ============================================================================

// model SalesInvoice {
//   id              String   @id @default(cuid())
//   invoiceNumber   String   @unique
//   customerId      String
//   date            DateTime
//   dueDate         DateTime
//   destination     String?
//   loadingLocation String?  @default("Enugu KVTS Industries")

//   currencyId   String
//   exchangeRate Decimal @db.Decimal(18, 6) @default(1)

//   // -- New Logistics & Tax Fields --
//   subTotal     Decimal @db.Decimal(18, 2) @default(0)
//   taxRate      Decimal @db.Decimal(5, 2)  @default(0) // e.g., 7.5
//   taxAmount    Decimal @db.Decimal(18, 2) @default(0)
//   logisticsFee Decimal @db.Decimal(18, 2) @default(0)
  
//   // Existing totals (Required)
//   totalAmount  Decimal @db.Decimal(18, 2)
//   paidAmount   Decimal @db.Decimal(18, 2) @default(0)
//   balanceDue   Decimal @db.Decimal(18, 2)

//   status InvoiceStatus @default(DRAFT)
//   notes  String?

//   createdAt DateTime @default(now())
//   updatedAt DateTime @updatedAt

//   customer       Customer             @relation(fields: [customerId], references: [id])
//   currency       Currency             @relation(fields: [currencyId], references: [id])
//   items          SalesInvoiceItem[]
//   payments       PaymentApplication[]
//   journalEntryId String?              @unique
//   journalEntry   JournalEntry?        @relation(fields: [journalEntryId], references: [id])

//   @@map("sales_invoices")
// }

// model SalesInvoiceItem {
//   id          String  @id @default(cuid())
//   invoiceId   String
//   productId   String
//   packageType String?

//   quantity  Int
//   unitPrice Decimal @db.Decimal(18, 2)
//   total     Decimal @db.Decimal(18, 2)
//   taxAmount Decimal @db.Decimal(18, 2) @default(0)

//   invoice SalesInvoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
//   product Product      @relation(fields: [productId], references: [id])

//   @@map("sales_invoice_items")
// }

// // ============================================================================
// // 10. SYSTEM & UTIL
// // ============================================================================

// model SystemSetting {
//   id String @id @default(cuid())

//   companyName    String  @default("KVTS INDUSTRIES CO., LTD.")
//   companyAddress String  @db.Text
//   companyPhone   String?
//   companyEmail   String?

//   defaultTaxRate Decimal @db.Decimal(5, 2) @default(7.5)
//   currencySymbol String  @default("₦")

//   updatedAt DateTime @updatedAt

//   @@map("system_settings")
// }

// model Announcement {
//   id          String   @id @default(cuid())
//   title       String
//   message     String   @db.Text
//   isActive    Boolean  @default(true)
//   createdAt   DateTime @default(now())
//   updatedAt   DateTime @updatedAt
//   createdById String

//   createdBy User @relation(fields: [createdById], references: [id])

//   @@map("announcements")
// }


// ============================================================================
// CONFIGURATION
// ============================================================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql" // or "mysql" if you are using MySQL
  url      = env("DATABASE_URL")
}

// ============================================================================
// ENUMS (Type Definitions)
// ============================================================================

enum Role {
  SUPER_ADMIN
  ADMIN
  ACCOUNTANT
  PRODUCTION_MANAGER
  SALES_MANAGER
  STORE_KEEPER
  HR
  USER
}

enum CurrencyCode {
  USD
  EUR
  NGN
  GBP
}

enum AssetStatus {
  ACTIVE
  IN_REPAIR
  LOST
  DAMAGED
  DISPOSED
}

enum ExpenseStatus {
  PENDING
  APPROVED
  REJECTED
  PAID
}

enum ExpensePaymentMethod {
  CASH
  TRANSFER
  CHEQUE
  POS
  MOBILE_MONEY
}

enum RecurringInterval {
  DAILY
  WEEKLY
  MONTHLY
  YEARLY
}

enum InvoiceStatus {
  DRAFT
  SENT
  PARTIALLY_PAID
  PAID
  OVERDUE
  VOID
}

enum PaymentMethod {
  CASH
  BANK_TRANSFER
  CHECK
  CREDIT_FROM_OVERPAYMENT
}

enum ProductType {
  RAW_MATERIAL
  WORK_IN_PROGRESS
  FINISHED_GOOD
  SERVICE
}

enum AccountType {
  ASSET
  LIABILITY
  EQUITY
  REVENUE
  EXPENSE
}

enum DeprMethod {
  STRAIGHT_LINE
  DECLINING_BALANCE
  UNITS_OF_PRODUCTION
}

// --- NEW HR ENUMS ---
enum EmployeeStatus {
  ACTIVE
  SUSPENDED
  TERMINATED
  ON_LEAVE
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum EmploymentType {
  FULL_TIME
  PART_TIME
  CONTRACT
  INTERN
}

// ============================================================================
// 1. AUTHENTICATION & CORE SETTINGS
// ============================================================================

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  name         String?
  passwordHash String
  role         Role     @default(USER)
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // RELATIONS
  employeeProfile  Employee?

  // Actions performed by this user
  approvedExpenses  Expense[]          @relation("ExpenseApprover")
  purchaseOrders    PurchaseOrder[]    @relation("POCreator")
  journalEntries    JournalEntry[]     @relation("EntryCreator")
  announcements     Announcement[]
  productionReports ProductionReport[] @relation("ReportCreator")

  @@map("users")
}

model Currency {
  id             String       @id @default(cuid())
  code           CurrencyCode @unique
  name           String
  symbol         String
  isBaseCurrency Boolean      @default(false)
  isActive       Boolean      @default(true)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  // RELATIONS
  exchangeRates ExchangeRate[]
  invoices      SalesInvoice[]
  payments      CustomerPayment[]
  expenses      Expense[]
  employees     Employee[]
  payrolls      Payroll[]

  @@map("currencies")
}

model ExchangeRate {
  id         String   @id @default(cuid())
  currencyId String
  rate       Decimal  @db.Decimal(18, 6)
  date       DateTime @default(now())

  currency Currency @relation(fields: [currencyId], references: [id], onDelete: Cascade)

  @@index([currencyId, date])
  @@map("exchange_rates")
}

// ============================================================================
// 2. HR & PAYROLL MANAGEMENT (UPDATED)
// ============================================================================

model Employee {
  id             String   @id @default(cuid())
  
  // -- 1. Basic Identification --
  employeeNumber String   @unique // e.g., EMP-001
  firstName      String
  lastName       String
  email          String?  @unique
  phone          String?
  address        String?  @db.Text
  
  // -- 2. Personal Information (NEW) --
  dateOfBirth    DateTime?
  gender         Gender?
  nationality    String?
  
  // -- 3. Emergency Contact (NEW) --
  emergencyContactName     String?
  emergencyContactRelation String? // e.g. Spouse, Father
  emergencyContactPhone    String?

  // -- 4. Bank Details (NEW - For Salary) --
  bankName          String?
  bankAccountNumber String?
  bankAccountName   String?
  bankBranch        String? // Optional Branch/Sort Code

  // -- 5. Job Details --
  position        String
  departmentId    String
  subDepartmentId String?
  hireDate        DateTime
  
  // Employment Meta (NEW)
  employmentType  EmploymentType @default(FULL_TIME)
  workSchedule    String?        // e.g. "Mon-Fri, 9am-5pm"
  status          EmployeeStatus @default(ACTIVE)
  
  // -- 6. Compensation --
  basicSalary     Decimal  @db.Decimal(18, 2)
  currencyId      String
  
  // Link to System User
  userId          String?  @unique 
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // RELATIONS
  department      Department     @relation(fields: [departmentId], references: [id])
  subDepartment   SubDepartment? @relation(fields: [subDepartmentId], references: [id])
  currency        Currency       @relation(fields: [currencyId], references: [id])
  user            User?          @relation(fields: [userId], references: [id])
  
  assignedAssets  Asset[]
  payrolls        Payroll[]
  statusLogs      EmployeeStatusLog[]

  @@map("employees")
}

model EmployeeStatusLog {
  id          String         @id @default(cuid())
  employeeId  String
  employee    Employee       @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  
  oldStatus   EmployeeStatus
  newStatus   EmployeeStatus
  
  changedAt   DateTime       @default(now())

  @@map("employee_status_logs")
}

model Department {
  id             String          @id @default(cuid())
  name           String          @unique
  subDepartments SubDepartment[] 
  employees      Employee[]
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt

  @@map("departments")
}

model SubDepartment {
  id           String     @id @default(cuid())
  name         String
  
  departmentId String
  department   Department @relation(fields: [departmentId], references: [id], onDelete: Cascade)
  
  employees    Employee[] 

  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  @@unique([name, departmentId]) 
  @@map("sub_departments")
}

model Payroll {
  id              String   @id @default(cuid())
  employeeId      String
  payPeriodStart  DateTime
  payPeriodEnd    DateTime
  
  basicSalary     Decimal  @db.Decimal(18, 2)
  totalAllowances Decimal  @db.Decimal(18, 2) @default(0)
  totalDeductions Decimal  @db.Decimal(18, 2) @default(0)
  netPay          Decimal  @db.Decimal(18, 2)
  
  currencyId      String
  status          String   @default("DRAFT") // DRAFT, PROCESSED, PAID
  paymentDate     DateTime?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  employee        Employee           @relation(fields: [employeeId], references: [id])
  currency        Currency           @relation(fields: [currencyId], references: [id])
  components      PayrollComponent[]

  @@map("payrolls")
}

model PayrollComponent {
  id        String  @id @default(cuid())
  payrollId String
  name      String  // e.g., "Overtime", "Tax"
  type      String  // EARNING, DEDUCTION
  amount    Decimal @db.Decimal(18, 2)
  
  payroll   Payroll @relation(fields: [payrollId], references: [id], onDelete: Cascade)

  @@map("payroll_components")
}

// ============================================================================
// 3. ASSET MANAGEMENT
// ============================================================================

model Asset {
  id                   String      @id @default(cuid())
  
  // Identification
  assetTag             String      @unique 
  name                 String
  category             String      
  description          String?     @db.Text
  serialNumber         String?     @unique
  
  // Acquisition
  purchaseDate         DateTime
  purchaseCost         Decimal     @db.Decimal(18, 2)
  vendor               String?     
  supplierId           String?     
  
  // Warranty
  warrantyStart        DateTime?
  warrantyEnd          DateTime?
  warrantyPeriodMonths Int?
  
  // State & Location
  status               AssetStatus @default(ACTIVE)
  condition            String?     
  location             String?
  department           String?
  
  // Assignment (Who has it?)
  assignedToEmployeeId String?
  
  // Maintenance Tracking
  lastMaintenance      DateTime?
  nextMaintenance      DateTime?
  
  // Disposal Logic
  disposed             Boolean     @default(false)
  disposalDate         DateTime?
  disposalReason       String?     @db.Text
  
  createdAt            DateTime    @default(now())
  updatedAt            DateTime    @updatedAt

  // RELATIONS
  assignedTo           Employee?          @relation(fields: [assignedToEmployeeId], references: [id])
  supplier             Supplier?          @relation(fields: [supplierId], references: [id])
  maintenanceRecords   AssetMaintenance[]

  @@map("assets")
}

model AssetMaintenance {
  id              String   @id @default(cuid())
  assetId         String
  maintenanceDate DateTime
  description     String   @db.Text
  cost            Decimal  @db.Decimal(18, 2)
  performedBy     String?
  createdAt       DateTime @default(now())
  
  asset           Asset    @relation(fields: [assetId], references: [id], onDelete: Cascade)

  @@map("asset_maintenances")
}

// ============================================================================
// 4. PRODUCTION & INVENTORY
// ============================================================================

model Product {
  id           String      @id @default(cuid())
  code         String      @unique 
  sku          String?     
  name         String
  type         ProductType @default(FINISHED_GOOD)
  brand        String?
  description  String?
  
  // Inventory
  stockOnHand  Int         @default(0)
  reorderLevel Int         @default(10)
  
  // Financials
  costPrice    Decimal     @db.Decimal(18, 2)
  sellingPrice Decimal     @db.Decimal(18, 2)
  
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt

  // RELATIONS
  inventoryMovements InventoryMovement[]
  invoiceItems       SalesInvoiceItem[]
  poItems            PurchaseOrderItem[]
  productionReports  ProductionReport[]
  
  // BOM
  bomParent          BillOfMaterial[]    @relation("BOMParent")
  bomChild           BillOfMaterial[]    @relation("BOMComponent")

  @@map("products")
}

model BillOfMaterial {
  id          String  @id @default(cuid())
  parentId    String  
  componentId String  
  quantity    Decimal @db.Decimal(12, 4) 
  
  parent      Product @relation("BOMParent", fields: [parentId], references: [id])
  component   Product @relation("BOMComponent", fields: [componentId], references: [id])

  @@unique([parentId, componentId])
  @@map("bill_of_materials")
}

model InventoryMovement {
  id          String   @id @default(cuid())
  productId   String
  type        String   
  quantity    Int      
  referenceId String?  
  date        DateTime @default(now())
  
  product     Product  @relation(fields: [productId], references: [id])

  @@index([productId, date])
  @@map("inventory_movements")
}

model ProductionReport {
  id           String   @id @default(cuid())
  batchNumber  String   @unique
  date         DateTime
  shift        String   
  
  productId    String   
  totalQty     Int
  qualifiedQty Int
  rejectedQty  Int      @default(0)
  
  // Detailed Reporting
  rawMaterialsUsed Json?   
  staffId          String? 
  
  notes        String?  @db.Text
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  product      Product            @relation(fields: [productId], references: [id])
  staff        User?              @relation("ReportCreator", fields: [staffId], references: [id])
  defects      ProductionDefect[]

  @@map("production_reports")
}

model ProductionDefect {
  id                 String @id @default(cuid())
  productionReportId String
  defectType         String 
  quantity           Int
  
  productionReport   ProductionReport @relation(fields: [productionReportId], references: [id], onDelete: Cascade)

  @@map("production_defects")
}

// ============================================================================
// 5. SALES, CUSTOMERS & DEBTORS
// ============================================================================

model Customer {
  id             String   @id @default(cuid())
  name           String
  code           String?  @unique
  email          String?
  phone          String?
  address        String?  @db.Text
  
  currentBalance Decimal  @db.Decimal(18, 2) @default(0) 
  creditLimit    Decimal? @db.Decimal(18, 2)
  
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  invoices       SalesInvoice[]
  payments       CustomerPayment[]

  @@map("customers")
}

model CustomerPayment {
  id            String        @id @default(cuid())
  paymentNumber String        @unique
  customerId    String
  date          DateTime      @default(now())
  
  amount        Decimal       @db.Decimal(18, 2) 
  unusedAmount  Decimal       @db.Decimal(18, 2) 
  
  method        PaymentMethod
  reference     String?       
  currencyId    String

  customer      Customer             @relation(fields: [customerId], references: [id])
  currency      Currency             @relation(fields: [currencyId], references: [id])
  applications  PaymentApplication[] 

  @@map("customer_payments")
}

model PaymentApplication {
  id            String   @id @default(cuid())
  paymentId     String
  invoiceId     String
  amountApplied Decimal  @db.Decimal(18, 2)
  appliedAt     DateTime @default(now())

  payment       CustomerPayment @relation(fields: [paymentId], references: [id])
  invoice       SalesInvoice    @relation(fields: [invoiceId], references: [id])

  @@map("payment_applications")
}

// ============================================================================
// 6. PURCHASING & SUPPLIERS
// ============================================================================

model Supplier {
  id             String   @id @default(cuid())
  name           String
  email          String?
  phone          String?
  balance        Decimal  @db.Decimal(18, 2) @default(0)
  
  createdAt      DateTime @default(now())
  
  purchaseOrders PurchaseOrder[]
  assets         Asset[]
  expenses       Expense[]

  @@map("suppliers")
}

model PurchaseOrder {
  id          String   @id @default(cuid())
  poNumber    String   @unique
  supplierId  String
  date        DateTime @default(now())
  status      String   @default("DRAFT")
  
  totalAmount Decimal  @db.Decimal(18, 2)
  createdById String
  
  supplier    Supplier            @relation(fields: [supplierId], references: [id])
  creator     User                @relation("POCreator", fields: [createdById], references: [id])
  items       PurchaseOrderItem[]

  @@map("purchase_orders")
}

model PurchaseOrderItem {
  id              String  @id @default(cuid())
  purchaseOrderId String
  productId       String
  quantity        Int
  unitCost        Decimal @db.Decimal(18, 2)
  total           Decimal @db.Decimal(18, 2)

  purchaseOrder   PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)
  product         Product       @relation(fields: [productId], references: [id])

  @@map("purchase_order_items")
}

// ============================================================================
// 7. EXPENSE TRACKING
// ============================================================================

model Expense {
  id                String               @id @default(cuid())
  
  expenseCode       String               @unique 
  title             String
  description       String?              @db.Text
  category          String               
  
  amount            Decimal              @db.Decimal(18, 2)
  currencyId        String
  paymentMethod     ExpensePaymentMethod
  
  vendor            String?              
  supplierId        String?              
  
  incurredDate      DateTime
  department        String?
  project           String?
  
  status            ExpenseStatus        @default(PENDING)
  approvedById      String?              
  
  attachmentUrl     String?              
  
  recurring         Boolean              @default(false)
  recurringInterval RecurringInterval?
  
  notes             String?              @db.Text
  createdAt         DateTime             @default(now())
  updatedAt         DateTime             @updatedAt

  currency          Currency       @relation(fields: [currencyId], references: [id])
  approvedBy        User?          @relation("ExpenseApprover", fields: [approvedById], references: [id])
  supplier          Supplier?      @relation(fields: [supplierId], references: [id])
  
  journalEntryId    String?        @unique
  journalEntry      JournalEntry?  @relation(fields: [journalEntryId], references: [id])

  @@map("expenses")
}

// ============================================================================
// 8. ACCOUNTING (General Ledger)
// ============================================================================

model ChartOfAccount {
  id              String   @id @default(cuid())
  code            String   @unique 
  name            String   
  type            AccountType
  isSystemAccount Boolean  @default(false) 
  
  entries         JournalEntryLine[]

  @@map("chart_of_accounts")
}

model JournalEntry {
  id           String   @id @default(cuid())
  entryNumber  String   @unique
  date         DateTime
  description  String?
  reference    String?  
  posted       Boolean  @default(false)
  createdById  String?
  
  createdAt    DateTime @default(now())

  creator      User?              @relation("EntryCreator", fields: [createdById], references: [id])
  lines        JournalEntryLine[]
  
  salesInvoice SalesInvoice?
  expense      Expense?

  @@map("journal_entries")
}

model JournalEntryLine {
  id             String  @id @default(cuid())
  journalEntryId String
  accountId      String
  
  debit          Decimal @db.Decimal(18, 2) @default(0)
  credit         Decimal @db.Decimal(18, 2) @default(0)
  
  account        ChartOfAccount @relation(fields: [accountId], references: [id])
  journalEntry   JournalEntry   @relation(fields: [journalEntryId], references: [id], onDelete: Cascade)

  @@map("journal_entry_lines")
}

// ============================================================================
// 9. SALES INVOICING
// ============================================================================

model SalesInvoice {
  id              String        @id @default(cuid())
  invoiceNumber   String        @unique
  customerId      String
  date            DateTime
  dueDate         DateTime
  
  destination     String?       
  loadingLocation String?       @default("Enugu KVTS Industries") 
  
  currencyId      String
  exchangeRate    Decimal       @db.Decimal(18, 6) @default(1)
  
  // Tax & Logistics
  subTotal        Decimal       @db.Decimal(18, 2) @default(0)
  taxRate         Decimal       @db.Decimal(5, 2)  @default(0) 
  taxAmount       Decimal       @db.Decimal(18, 2) @default(0)
  logisticsFee    Decimal       @db.Decimal(18, 2) @default(0)
  
  totalAmount     Decimal       @db.Decimal(18, 2)
  paidAmount      Decimal       @db.Decimal(18, 2) @default(0)
  balanceDue      Decimal       @db.Decimal(18, 2)
  
  status          InvoiceStatus @default(DRAFT)
  notes           String?
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  customer        Customer             @relation(fields: [customerId], references: [id])
  currency        Currency             @relation(fields: [currencyId], references: [id])
  items           SalesInvoiceItem[]
  payments        PaymentApplication[]
  journalEntryId  String?              @unique
  journalEntry    JournalEntry?        @relation(fields: [journalEntryId], references: [id])

  @@map("sales_invoices")
}

model SalesInvoiceItem {
  id        String  @id @default(cuid())
  invoiceId String
  productId String
  
  packageType String? 

  quantity  Int
  unitPrice Decimal @db.Decimal(18, 2)
  total     Decimal @db.Decimal(18, 2)
  taxAmount Decimal @db.Decimal(18, 2) @default(0)

  invoice   SalesInvoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  product   Product      @relation(fields: [productId], references: [id])

  @@map("sales_invoice_items")
}

// ============================================================================
// 10. SYSTEM & UTIL
// ============================================================================

model SystemSetting {
  id              String   @id @default(cuid())
  
  companyName     String   @default("KVTS INDUSTRIES CO., LTD.")
  companyAddress  String   @db.Text
  companyPhone    String?
  companyEmail    String?
  
  defaultTaxRate  Decimal  @db.Decimal(5, 2) @default(7.5) 
  currencySymbol  String   @default("₦")
  
  updatedAt       DateTime @updatedAt

  @@map("system_settings")
}

model Announcement {
  id          String   @id @default(cuid())
  title       String
  message     String   @db.Text
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  createdById String
  createdBy   User     @relation(fields: [createdById], references: [id])

  @@map("announcements")
}