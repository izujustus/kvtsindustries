

// generator client {
//   provider = "prisma-client-js"
// }

// datasource db {
//   provider = "postgresql"
//   url      = env("DATABASE_URL")
// }

// // ============================================================================
// // ENUMS (Type Definitions)
// // ============================================================================

// enum Role {
//   SUPER_ADMIN
//   ADMIN
//   ACCOUNTANT
//   PRODUCTION_MANAGER
//   SALES_MANAGER
//   STORE_KEEPER
//   HR
//   USER
// }

// enum CurrencyCode {
//   USD
//   EUR
//   NGN
//   GBP
// }

// enum AssetStatus {
//   ACTIVE
//   IN_REPAIR
//   LOST
//   DAMAGED
//   DISPOSED
// }

// enum ExpenseStatus {
//   PENDING
//   APPROVED
//   REJECTED
//   PAID
// }

// enum ExpensePaymentMethod {
//   CASH
//   TRANSFER
//   CHEQUE
//   POS
//   MOBILE_MONEY
// }

// enum RecurringInterval {
//   DAILY
//   WEEKLY
//   MONTHLY
//   YEARLY
// }

// enum InvoiceStatus {
//   DRAFT
//   PENDING_CONFIRMATION 
//   CONFIRMED            
//   SENT
//   PARTIALLY_PAID
//   PAID
//   OVERDUE
//   VOID
// }

// enum ProformaStatus {
//   DRAFT
//   SENT
//   CONVERTED_TO_INVOICE
//   EXPIRED
// }

// enum PaymentMethod {
//   CASH
//   BANK_TRANSFER
//   CHECK
//   CREDIT_FROM_OVERPAYMENT
// }

// enum ProductType {
//   RAW_MATERIAL
//   WORK_IN_PROGRESS
//   FINISHED_GOOD
//   SERVICE
// }

// enum AccountType {
//   ASSET
//   LIABILITY
//   EQUITY
//   REVENUE
//   EXPENSE
// }

// enum DeprMethod {
//   STRAIGHT_LINE
//   DECLINING_BALANCE
//   UNITS_OF_PRODUCTION
// }

// // --- HR ENUMS ---
// enum EmployeeStatus {
//   ACTIVE
//   SUSPENDED
//   TERMINATED
//   ON_LEAVE
// }

// enum Gender {
//   MALE
//   FEMALE
//   OTHER
// }

// enum EmploymentType {
//   FULL_TIME
//   PART_TIME
//   CONTRACT
//   INTERN
// }

// // ============================================================================
// // 1. AUTHENTICATION & CORE SETTINGS
// // ============================================================================

// model User {
//   id           String   @id @default(cuid())
//   email        String   @unique
//   name         String?
//   passwordHash String
//   role         Role     @default(USER)
//   isActive     Boolean  @default(true)
//   createdAt    DateTime @default(now())
//   updatedAt    DateTime @updatedAt

//   // RELATIONS
//   employeeProfile  Employee?

//   // Actions performed by this user
//   approvedExpenses  Expense[]          @relation("ExpenseApprover")
//   purchaseOrders    PurchaseOrder[]    @relation("POCreator")
//   journalEntries    JournalEntry[]     @relation("EntryCreator")
//   announcements     Announcement[]
//   productionReports ProductionReport[] @relation("ReportCreator")
  
//   createdProformas  ProformaInvoice[]  @relation("ProformaCreator")

//   @@map("users")
// }

// model Currency {
//   id             String       @id @default(cuid())
//   code           CurrencyCode @unique
//   name           String
//   symbol         String
//   isBaseCurrency Boolean      @default(false)
//   isActive       Boolean      @default(true)
//   createdAt      DateTime     @default(now())
//   updatedAt      DateTime     @updatedAt

//   // RELATIONS
//   exchangeRates    ExchangeRate[]
//   invoices         SalesInvoice[]
//   payments         CustomerPayment[]
//   expenses         Expense[]
//   employees        Employee[]
//   payrolls         Payroll[]
  
//   supplierPayments SupplierPayment[]
//   proformas        ProformaInvoice[]

//   @@map("currencies")
// }

// model ExchangeRate {
//   id         String   @id @default(cuid())
//   currencyId String
//   rate       Decimal  @db.Decimal(18, 6)
//   date       DateTime @default(now())

//   currency Currency @relation(fields: [currencyId], references: [id], onDelete: Cascade)

//   @@index([currencyId, date])
//   @@map("exchange_rates")
// }

// // ============================================================================
// // 2. HR & PAYROLL MANAGEMENT
// // ============================================================================

// model Employee {
//   id             String   @id @default(cuid())
  
//   // -- 1. Basic Identification --
//   employeeNumber String   @unique 
//   firstName      String
//   lastName       String
//   email          String?  @unique
//   phone          String?
//   address        String?  @db.Text
//   imageUrl       String?
  
//   // -- 2. Personal Information --
//   dateOfBirth    DateTime?
//   gender         Gender?
//   nationality    String?
  
//   // -- 3. Emergency Contact --
//   emergencyContactName     String?
//   emergencyContactRelation String? 
//   emergencyContactPhone    String?

//   // -- 4. Bank Details --
//   bankName          String?
//   bankAccountNumber String?
//   bankAccountName   String?
//   bankBranch        String? 

//   // -- 5. Job Details --
//   position        String
//   departmentId    String
//   subDepartmentId String?
//   hireDate        DateTime
  
//   // Employment Meta 
//   employmentType  EmploymentType @default(FULL_TIME)
//   workSchedule    String?        
//   status          EmployeeStatus @default(ACTIVE)
  
//   // -- 6. Compensation --
//   basicSalary     Decimal  @db.Decimal(18, 2)
//   currencyId      String
  
//   // Link to System User
//   userId          String?  @unique 
  
//   createdAt       DateTime @default(now())
//   updatedAt       DateTime @updatedAt

//   // RELATIONS
//   department      Department     @relation(fields: [departmentId], references: [id])
//   subDepartment   SubDepartment? @relation(fields: [subDepartmentId], references: [id])
//   currency        Currency       @relation(fields: [currencyId], references: [id])
//   user            User?          @relation(fields: [userId], references: [id])
  
//   assignedAssets  Asset[]
//   payrolls        Payroll[]
//   statusLogs      EmployeeStatusLog[]

//   @@map("employees")
// }

// model EmployeeStatusLog {
//   id          String         @id @default(cuid())
//   employeeId  String
//   employee    Employee       @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  
//   oldStatus   EmployeeStatus
//   newStatus   EmployeeStatus
  
//   changedAt   DateTime       @default(now())

//   @@map("employee_status_logs")
// }

// model Department {
//   id             String          @id @default(cuid())
//   name           String          @unique
//   subDepartments SubDepartment[] 
//   employees      Employee[]
//   createdAt      DateTime        @default(now())
//   updatedAt      DateTime        @updatedAt

//   @@map("departments")
// }

// model SubDepartment {
//   id           String     @id @default(cuid())
//   name         String
  
//   departmentId String
//   department   Department @relation(fields: [departmentId], references: [id], onDelete: Cascade)
  
//   employees    Employee[] 

//   createdAt    DateTime   @default(now())
//   updatedAt    DateTime   @updatedAt

//   @@unique([name, departmentId]) 
//   @@map("sub_departments")
// }

// model Payroll {
//   id              String   @id @default(cuid())
//   employeeId      String
//   payPeriodStart  DateTime
//   payPeriodEnd    DateTime
  
//   basicSalary     Decimal  @db.Decimal(18, 2)
//   totalAllowances Decimal  @db.Decimal(18, 2) @default(0)
//   totalDeductions Decimal  @db.Decimal(18, 2) @default(0)
//   netPay          Decimal  @db.Decimal(18, 2)
  
//   currencyId      String
//   status          String   @default("DRAFT") // DRAFT, PROCESSED, PAID
//   paymentDate     DateTime?
  
//   createdAt       DateTime @default(now())
//   updatedAt       DateTime @updatedAt

//   employee        Employee           @relation(fields: [employeeId], references: [id])
//   currency        Currency           @relation(fields: [currencyId], references: [id])
//   components      PayrollComponent[]

//   @@map("payrolls")
// }

// model PayrollComponent {
//   id        String  @id @default(cuid())
//   payrollId String
//   name      String  
//   type      String  // EARNING, DEDUCTION
//   amount    Decimal @db.Decimal(18, 2)
  
//   payroll   Payroll @relation(fields: [payrollId], references: [id], onDelete: Cascade)

//   @@map("payroll_components")
// }

// // ============================================================================
// // 3. ASSET MANAGEMENT
// // ============================================================================

// model Asset {
//   id                   String      @id @default(cuid())
  
//   // Identification
//   assetTag             String      @unique 
//   name                 String
//   category             String      
//   description          String?     @db.Text
//   serialNumber         String?     @unique
  
//   // Acquisition
//   purchaseDate         DateTime
//   purchaseCost         Decimal     @db.Decimal(18, 2)
//   vendor               String?     
//   supplierId           String?     
  
//   // Warranty
//   warrantyStart        DateTime?
//   warrantyEnd          DateTime?
//   warrantyPeriodMonths Int?
  
//   // State & Location
//   status               AssetStatus @default(ACTIVE)
//   condition            String?     
//   location             String?
//   department           String?
  
//   // Assignment (Who has it?)
//   assignedToEmployeeId String?
  
//   // Maintenance Tracking
//   lastMaintenance      DateTime?
//   nextMaintenance      DateTime?
  
//   // Disposal Logic
//   disposed             Boolean     @default(false)
//   disposalDate         DateTime?
//   disposalReason       String?     @db.Text
  
//   createdAt            DateTime    @default(now())
//   updatedAt            DateTime    @updatedAt

//   // RELATIONS
//   assignedTo           Employee?          @relation(fields: [assignedToEmployeeId], references: [id])
//   supplier             Supplier?          @relation(fields: [supplierId], references: [id])
//   maintenanceRecords   AssetMaintenance[]

//   @@map("assets")
// }

// model AssetMaintenance {
//   id              String   @id @default(cuid())
//   assetId         String
//   maintenanceDate DateTime
//   description     String   @db.Text
//   cost            Decimal  @db.Decimal(18, 2)
//   performedBy     String?
//   createdAt       DateTime @default(now())
  
//   asset           Asset    @relation(fields: [assetId], references: [id], onDelete: Cascade)

//   @@map("asset_maintenances")
// }

// // ============================================================================
// // 4. PRODUCTION & INVENTORY
// // ============================================================================

// model ProductCategory {
//   id          String    @id @default(cuid())
//   name        String    @unique 
//   description String?   @db.Text
  
//   createdAt   DateTime  @default(now())
//   updatedAt   DateTime  @updatedAt

//   products    Product[]

//   @@map("product_categories")
// }

// model Product {
//   id           String      @id @default(cuid())
//   code         String      @unique 
//   sku          String?     
//   name         String
//   type         ProductType @default(FINISHED_GOOD)
//   brand        String?
//   description  String?
  
//   // Link to Dynamic Category
//   categoryId   String?     
//   category     ProductCategory? @relation(fields: [categoryId], references: [id])

//   // [UPDATED] Link to Supplier (Fixed Error here)
//   supplierId   String?
//   supplier     Supplier?        @relation(fields: [supplierId], references: [id])

//   // Inventory
//   stockOnHand  Int         @default(0)
//   reorderLevel Int         @default(10)
  
//   // Financials
//   costPrice    Decimal     @db.Decimal(18, 2)
//   sellingPrice Decimal     @db.Decimal(18, 2)
  
//   createdAt    DateTime    @default(now())
//   updatedAt    DateTime    @updatedAt

//   // RELATIONS
//   inventoryMovements InventoryMovement[]
//   invoiceItems       SalesInvoiceItem[]
//   poItems            PurchaseOrderItem[]
//   productionReports  ProductionReport[]
//   proformaItems      ProformaInvoiceItem[]
  
//   // BOM
//   bomParent          BillOfMaterial[]    @relation("BOMParent")
//   bomChild           BillOfMaterial[]    @relation("BOMComponent")

//   @@map("products")
//   productionOrders ProductionOrder[]
// }

// model BillOfMaterial {
//   id          String  @id @default(cuid())
//   parentId    String  
//   componentId String  
//   quantity    Decimal @db.Decimal(12, 4) 
  
//   parent      Product @relation("BOMParent", fields: [parentId], references: [id])
//   component   Product @relation("BOMComponent", fields: [componentId], references: [id])

//   @@unique([parentId, componentId])
//   @@map("bill_of_materials")
// }

// model InventoryMovement {
//   id          String   @id @default(cuid())
//   productId   String
//   type        String   
//   quantity    Int      
//   referenceId String?  
//   date        DateTime @default(now())
  
//   product     Product  @relation(fields: [productId], references: [id])

//   @@index([productId, date])
//   @@map("inventory_movements")
// }

// model ProductionReport {
//   id           String   @id @default(cuid())
//   batchNumber  String   @unique
//   date         DateTime
//   shift        String   
  
//   productId    String   
//   totalQty     Int
//   qualifiedQty Int
//   rejectedQty  Int      @default(0)
  
//   // Detailed Reporting
//   rawMaterialsUsed Json?   
//   staffId          String? 
  
//   notes        String?  @db.Text
//   createdAt    DateTime @default(now())
//   updatedAt    DateTime @updatedAt

//   product      Product            @relation(fields: [productId], references: [id])
//   staff        User?              @relation("ReportCreator", fields: [staffId], references: [id])
//   defects      ProductionDefect[]

//   @@map("production_reports")
// }

// model ProductionDefect {
//   id                 String @id @default(cuid())
//   productionReportId String
//   defectType         String 
//   quantity           Int
  
//   productionReport   ProductionReport @relation(fields: [productionReportId], references: [id], onDelete: Cascade)

//   @@map("production_defects")
// }

// // ============================================================================
// // 5. SALES, CUSTOMERS & DEBTORS
// // ============================================================================

// model Customer {
//   id             String   @id @default(cuid())
//   name           String
//   code           String?  @unique
//   email          String?
//   phone          String?
//   address        String?  @db.Text
  
//   currentBalance Decimal  @db.Decimal(18, 2) @default(0) 
//   creditLimit    Decimal? @db.Decimal(18, 2)
  
//   createdAt      DateTime @default(now())
//   updatedAt      DateTime @updatedAt

//   invoices       SalesInvoice[]
//   payments       CustomerPayment[]
//   proformas      ProformaInvoice[]

//   @@map("customers")
// }

// model CustomerPayment {
//   id            String        @id @default(cuid())
//   paymentNumber String        @unique
//   customerId    String
//   date          DateTime      @default(now())
  
//   amount        Decimal       @db.Decimal(18, 2) 
//   unusedAmount  Decimal       @db.Decimal(18, 2) 
  
//   method        PaymentMethod
//   reference     String?       
//   currencyId    String

//   customer      Customer             @relation(fields: [customerId], references: [id])
//   currency      Currency             @relation(fields: [currencyId], references: [id])
//   applications  PaymentApplication[] 

//   @@map("customer_payments")
// }

// model PaymentApplication {
//   id            String   @id @default(cuid())
//   paymentId     String
//   invoiceId     String
//   amountApplied Decimal  @db.Decimal(18, 2)
//   appliedAt     DateTime @default(now())

//   payment       CustomerPayment @relation(fields: [paymentId], references: [id])
//   invoice       SalesInvoice    @relation(fields: [invoiceId], references: [id])

//   @@map("payment_applications")
// }

// // ============================================================================
// // 6. PURCHASING & SUPPLIERS
// // ============================================================================

// model Supplier {
//   id             String   @id @default(cuid())
//   name           String
//   email          String?
//   phone          String?
//   balance        Decimal  @db.Decimal(18, 2) @default(0)
  
//   createdAt      DateTime @default(now())
  
//   purchaseOrders PurchaseOrder[]
//   assets         Asset[]
//   expenses       Expense[]
  
//   // [NEW] Supplier Relations (Fixed Error here)
//   payments       SupplierPayment[]
//   products       Product[]

//   @@map("suppliers")
// }

// model SupplierPayment {
//   id            String         @id @default(cuid())
//   paymentNumber String         @unique 
//   supplierId    String
//   date          DateTime       @default(now())
  
//   amount        Decimal        @db.Decimal(18, 2)
  
//   method        PaymentMethod
//   reference     String?        
//   currencyId    String
  
//   notes         String?        @db.Text
  
//   createdAt     DateTime       @default(now())
//   updatedAt     DateTime       @updatedAt

//   supplier      Supplier       @relation(fields: [supplierId], references: [id])
//   currency      Currency       @relation(fields: [currencyId], references: [id])

//   @@map("supplier_payments")
// }

// model PurchaseOrder {
//   id          String   @id @default(cuid())
//   poNumber    String   @unique
//   supplierId  String
//   date        DateTime @default(now())
//   status      String   @default("DRAFT")
  
//   totalAmount Decimal  @db.Decimal(18, 2)
//   createdById String
  
//   supplier    Supplier            @relation(fields: [supplierId], references: [id])
//   creator     User                @relation("POCreator", fields: [createdById], references: [id])
//   items       PurchaseOrderItem[]

//   @@map("purchase_orders")
// }

// model PurchaseOrderItem {
//   id              String  @id @default(cuid())
//   purchaseOrderId String
//   productId       String
//   quantity        Int
//   unitCost        Decimal @db.Decimal(18, 2)
//   total           Decimal @db.Decimal(18, 2)

//   purchaseOrder   PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)
//   product         Product       @relation(fields: [productId], references: [id])

//   @@map("purchase_order_items")
// }

// // ============================================================================
// // 7. EXPENSE TRACKING
// // ============================================================================

// model Expense {
//   id                String               @id @default(cuid())
  
//   expenseCode       String               @unique 
//   title             String
//   description       String?              @db.Text
//   category          String               
  
//   amount            Decimal              @db.Decimal(18, 2)
//   currencyId        String
//   paymentMethod     ExpensePaymentMethod
  
//   vendor            String?              
//   supplierId        String?              
  
//   incurredDate      DateTime
//   department        String?
//   project           String?
  
//   status            ExpenseStatus        @default(PENDING)
//   approvedById      String?              
  
//   attachmentUrl     String?              
  
//   recurring         Boolean              @default(false)
//   recurringInterval RecurringInterval?
  
//   notes             String?              @db.Text
//   createdAt         DateTime             @default(now())
//   updatedAt         DateTime             @updatedAt

//   currency          Currency       @relation(fields: [currencyId], references: [id])
//   approvedBy        User?          @relation("ExpenseApprover", fields: [approvedById], references: [id])
//   supplier          Supplier?      @relation(fields: [supplierId], references: [id])
  
//   journalEntryId    String?        @unique
//   journalEntry      JournalEntry?  @relation(fields: [journalEntryId], references: [id])

//   @@map("expenses")
// }

// // ============================================================================
// // 8. ACCOUNTING (General Ledger)
// // ============================================================================

// model ChartOfAccount {
//   id              String   @id @default(cuid())
//   code            String   @unique 
//   name            String   
//   type            AccountType
//   isSystemAccount Boolean  @default(false) 
  
//   entries         JournalEntryLine[]

//   @@map("chart_of_accounts")
// }

// model JournalEntry {
//   id           String   @id @default(cuid())
//   entryNumber  String   @unique
//   date         DateTime
//   description  String?
//   reference    String?  
//   posted       Boolean  @default(false)
//   createdById  String?
  
//   createdAt    DateTime @default(now())

//   creator      User?              @relation("EntryCreator", fields: [createdById], references: [id])
//   lines        JournalEntryLine[]
  
//   salesInvoice SalesInvoice?
//   expense      Expense?

//   @@map("journal_entries")
// }

// model JournalEntryLine {
//   id             String  @id @default(cuid())
//   journalEntryId String
//   accountId      String
  
//   debit          Decimal @db.Decimal(18, 2) @default(0)
//   credit         Decimal @db.Decimal(18, 2) @default(0)
  
//   account        ChartOfAccount @relation(fields: [accountId], references: [id])
//   journalEntry   JournalEntry   @relation(fields: [journalEntryId], references: [id], onDelete: Cascade)

//   @@map("journal_entry_lines")
// }

// // ============================================================================
// // 9. SALES INVOICING & PROFORMA
// // ============================================================================

// model SalesInvoice {
//   id              String        @id @default(cuid())
//   invoiceNumber   String?        @unique
//   customerId      String
//   date            DateTime
//   dueDate         DateTime
  
//   destination     String?       
//   loadingLocation String?       @default("Enugu KVTS Industries") 
  
//   currencyId      String
//   exchangeRate    Decimal       @db.Decimal(18, 6) @default(1)

//   isPosted        Boolean       @default(false) 

//   status          InvoiceStatus @default(DRAFT)
  
//   // Tax & Logistics
//   subTotal        Decimal       @db.Decimal(18, 2) @default(0)
//   taxRate         Decimal       @db.Decimal(5, 2)  @default(0) 
//   taxAmount       Decimal       @db.Decimal(18, 2) @default(0)
//   logisticsFee    Decimal       @db.Decimal(18, 2) @default(0)
  
//   totalAmount     Decimal       @db.Decimal(18, 2)
//   paidAmount      Decimal       @db.Decimal(18, 2) @default(0)
//   balanceDue      Decimal       @db.Decimal(18, 2)
  
  
//   notes           String?
  
//   createdAt       DateTime      @default(now())
//   updatedAt       DateTime      @updatedAt

//   customer        Customer             @relation(fields: [customerId], references: [id])
//   currency        Currency             @relation(fields: [currencyId], references: [id])
//   items           SalesInvoiceItem[]
//   payments        PaymentApplication[]
//   journalEntryId  String?              @unique
//   journalEntry    JournalEntry?        @relation(fields: [journalEntryId], references: [id])
  
//   fromProformaId  String?
//   fromProforma    ProformaInvoice?     @relation(fields: [fromProformaId], references: [id])

//   waybill         Waybill?

//   @@map("sales_invoices")
// }

// model SalesInvoiceItem {
//   id        String  @id @default(cuid())
//   invoiceId String
//   productId String
  
//   packageType String? 

//   quantity  Int
//   unitPrice Decimal @db.Decimal(18, 2)
//   total     Decimal @db.Decimal(18, 2)
//   taxAmount Decimal @db.Decimal(18, 2) @default(0)

//   invoice   SalesInvoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
//   product   Product      @relation(fields: [productId], references: [id])

//   @@map("sales_invoice_items")
// }

// model Waybill {
//   id              String       @id @default(cuid())
//   salesInvoiceId  String       @unique

//   // 3. The "Gate Pass" details
//   waybillNumber   String       @unique // e.g., WB-2025-001
//   gatePassCode    String?      // A short code (e.g., A7X-99) for security to radio in
  
 
//   dispatchDate    DateTime     @default(now())
  
//   vehicleNumber   String?
//   driverName      String?
//   driverPhone     String?
  
//   preparedBy      String?      // Staff Name
//   securityCheckBy String?      // Gate Security Name
  
//   createdAt       DateTime     @default(now())
//   updatedAt       DateTime     @updatedAt

//   salesInvoice    SalesInvoice @relation(fields: [salesInvoiceId], references: [id], onDelete: Cascade)

//   @@map("waybills")
// }

// model ProformaInvoice {
//   id              String         @id @default(cuid())
//   proformaNumber  String         @unique
//   customerId      String
//   date            DateTime       @default(now())
//   expiryDate      DateTime?
  
//   currencyId      String
  
//   subTotal        Decimal        @db.Decimal(18, 2) @default(0)
//   taxAmount       Decimal        @db.Decimal(18, 2) @default(0)
//   totalAmount     Decimal        @db.Decimal(18, 2)
  
//   status          ProformaStatus @default(DRAFT)
//   notes           String?        @db.Text
  
//   createdById     String
//   createdAt       DateTime       @default(now())
//   updatedAt       DateTime       @updatedAt

//   customer        Customer              @relation(fields: [customerId], references: [id])
//   currency        Currency              @relation(fields: [currencyId], references: [id])
//   creator         User                  @relation("ProformaCreator", fields: [createdById], references: [id])
//   items           ProformaInvoiceItem[]
  
//   convertedInvoices SalesInvoice[]

//   @@map("proforma_invoices")
// }

// model ProformaInvoiceItem {
//   id                String          @id @default(cuid())
//   proformaInvoiceId String
//   productId         String
  
//   description       String?         
//   quantity          Int
//   unitPrice         Decimal         @db.Decimal(18, 2)
//   total             Decimal         @db.Decimal(18, 2)

//   proformaInvoice   ProformaInvoice @relation(fields: [proformaInvoiceId], references: [id], onDelete: Cascade)
//   product           Product         @relation(fields: [productId], references: [id])

//   @@map("proforma_invoice_items")
// }

// // ============================================================================
// // 10. SYSTEM & UTIL
// // ============================================================================

// model SystemSetting {
//   id              String   @id @default(cuid())
  
//   companyName     String   @default("KVTS INDUSTRIES CO., LTD.")
//   companyAddress  String   @db.Text
//   companyPhone    String?
//   companyEmail    String?
  
//   defaultTaxRate  Decimal  @db.Decimal(5, 2) @default(7.5) 
//   currencySymbol  String   @default("â‚¦")
  
//   updatedAt       DateTime @updatedAt

//   @@map("system_settings")
// }

// model Announcement {
//   id          String   @id @default(cuid())
//   title       String
//   message     String   @db.Text
//   isActive    Boolean  @default(true)
//   createdAt   DateTime @default(now())
//   updatedAt   DateTime @updatedAt
  
//   createdById String
//   createdBy   User     @relation(fields: [createdById], references: [id])

//   @@map("announcements")
// }

// // --- ADD THIS ENUM ---
// enum OrderStatus {
//   DRAFT
//   PLANNED
//   IN_PROGRESS
//   COMPLETED
//   CANCELLED
// }

// // --- ADD THIS MODEL ---
// model ProductionOrder {
//   id            String      @id @default(cuid())
//   orderNumber   String      @unique // e.g. WO-2025-001
  
//   productId     String
//   product       Product     @relation(fields: [productId], references: [id])
  
//   quantity      Int         // Target Quantity
//   producedQty   Int         @default(0) // Actual produced so far
  
//   status        OrderStatus @default(DRAFT)
//   priority      String      @default("NORMAL") // LOW, NORMAL, HIGH
  
//   startDate     DateTime    @default(now())
//   dueDate       DateTime?
  
//   notes         String?     @db.Text
  
//   createdAt     DateTime    @default(now())
//   updatedAt     DateTime    @updatedAt

//   @@map("production_orders")
// }


generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================================================
// ENUMS (Type Definitions)
// ============================================================================

enum Role {
  SUPER_ADMIN
  ADMIN
  ACCOUNTANT
  PRODUCTION_MANAGER
  SALES_MANAGER
  STORE_KEEPER
  HR
  USER
}

enum CurrencyCode {
  USD
  EUR
  NGN
  GBP
}

enum AssetStatus {
  ACTIVE
  IN_REPAIR
  LOST
  DAMAGED
  DISPOSED
}

enum ExpenseStatus {
  PENDING
  APPROVED
  REJECTED
  PAID
}

enum ExpensePaymentMethod {
  CASH
  TRANSFER
  CHEQUE
  POS
  MOBILE_MONEY
}

enum RecurringInterval {
  DAILY
  WEEKLY
  MONTHLY
  YEARLY
}

enum InvoiceStatus {
  DRAFT
  PENDING_CONFIRMATION 
  CONFIRMED            
  SENT
  PARTIALLY_PAID
  PAID
  OVERDUE
  VOID
}

enum ProformaStatus {
  DRAFT
  SENT
  CONVERTED_TO_INVOICE
  EXPIRED
}

enum PaymentMethod {
  CASH
  BANK_TRANSFER
  CHECK
  CREDIT_FROM_OVERPAYMENT
}

enum ProductType {
  RAW_MATERIAL
  WORK_IN_PROGRESS
  FINISHED_GOOD
  SERVICE
}

enum AccountType {
  ASSET
  LIABILITY
  EQUITY
  REVENUE
  EXPENSE
}

enum DeprMethod {
  STRAIGHT_LINE
  DECLINING_BALANCE
  UNITS_OF_PRODUCTION
}

// --- HR ENUMS ---
enum EmployeeStatus {
  ACTIVE
  SUSPENDED
  TERMINATED
  ON_LEAVE
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum EmploymentType {
  FULL_TIME
  PART_TIME
  CONTRACT
  INTERN
}

// ============================================================================
// 1. AUTHENTICATION & CORE SETTINGS
// ============================================================================

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  name         String?
  passwordHash String
  role         Role     @default(USER)
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // RELATIONS
  employeeProfile  Employee?

  // Actions performed by this user
  approvedExpenses  Expense[]          @relation("ExpenseApprover")
  purchaseOrders    PurchaseOrder[]    @relation("POCreator")
  journalEntries    JournalEntry[]     @relation("EntryCreator")
  announcements     Announcement[]
  productionReports ProductionReport[] @relation("ReportCreator")
  
  createdProformas  ProformaInvoice[]  @relation("ProformaCreator")

  @@map("users")
}

model Currency {
  id             String       @id @default(cuid())
  code           CurrencyCode @unique
  name           String
  symbol         String
  isBaseCurrency Boolean      @default(false)
  isActive       Boolean      @default(true)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  // RELATIONS
  exchangeRates    ExchangeRate[]
  invoices         SalesInvoice[]
  payments         CustomerPayment[]
  expenses         Expense[]
  employees        Employee[]
  payrolls         Payroll[]
  
  supplierPayments SupplierPayment[]
  proformas        ProformaInvoice[]

  @@map("currencies")
}

model ExchangeRate {
  id         String   @id @default(cuid())
  currencyId String
  rate       Decimal  @db.Decimal(18, 6)
  date       DateTime @default(now())

  currency Currency @relation(fields: [currencyId], references: [id], onDelete: Cascade)

  @@index([currencyId, date])
  @@map("exchange_rates")
}

// ============================================================================
// 2. HR & PAYROLL MANAGEMENT
// ============================================================================

model Employee {
  id             String   @id @default(cuid())
  
  // -- 1. Basic Identification --
  employeeNumber String   @unique 
  firstName      String
  lastName       String
  email          String?  @unique
  phone          String?
  address        String?  @db.Text
  imageUrl       String?
  
  // -- 2. Personal Information --
  dateOfBirth    DateTime?
  gender         Gender?
  nationality    String?
  
  // -- 3. Emergency Contact --
  emergencyContactName     String?
  emergencyContactRelation String? 
  emergencyContactPhone    String?

  // -- 4. Bank Details --
  bankName          String?
  bankAccountNumber String?
  bankAccountName   String?
  bankBranch        String? 

  // -- 5. Job Details --
  position        String
  departmentId    String
  subDepartmentId String?
  hireDate        DateTime
  
  // Employment Meta 
  employmentType  EmploymentType @default(FULL_TIME)
  workSchedule    String?        
  status          EmployeeStatus @default(ACTIVE)
  
  // -- 6. Compensation --
  basicSalary     Decimal  @db.Decimal(18, 2)
  currencyId      String
  
  // Link to System User
  userId          String?  @unique 
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // RELATIONS
  department      Department     @relation(fields: [departmentId], references: [id])
  subDepartment   SubDepartment? @relation(fields: [subDepartmentId], references: [id])
  currency        Currency       @relation(fields: [currencyId], references: [id])
  user            User?          @relation(fields: [userId], references: [id])
  
  assignedAssets  Asset[]
  payrolls        Payroll[]
  statusLogs      EmployeeStatusLog[]

  @@map("employees")
}

model EmployeeStatusLog {
  id          String         @id @default(cuid())
  employeeId  String
  employee    Employee       @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  
  oldStatus   EmployeeStatus
  newStatus   EmployeeStatus
  
  changedAt   DateTime       @default(now())

  @@map("employee_status_logs")
}

model Department {
  id             String          @id @default(cuid())
  name           String          @unique
  subDepartments SubDepartment[] 
  employees      Employee[]
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt

  @@map("departments")
}

model SubDepartment {
  id           String     @id @default(cuid())
  name         String
  
  departmentId String
  department   Department @relation(fields: [departmentId], references: [id], onDelete: Cascade)
  
  employees    Employee[] 

  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  @@unique([name, departmentId]) 
  @@map("sub_departments")
}

model Payroll {
  id              String   @id @default(cuid())
  employeeId      String
  payPeriodStart  DateTime
  payPeriodEnd    DateTime
  
  basicSalary     Decimal  @db.Decimal(18, 2)
  totalAllowances Decimal  @db.Decimal(18, 2) @default(0)
  totalDeductions Decimal  @db.Decimal(18, 2) @default(0)
  netPay          Decimal  @db.Decimal(18, 2)
  
  currencyId      String
  status          String   @default("DRAFT") // DRAFT, PROCESSED, PAID
  paymentDate     DateTime?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  employee        Employee           @relation(fields: [employeeId], references: [id])
  currency        Currency           @relation(fields: [currencyId], references: [id])
  components      PayrollComponent[]

  @@map("payrolls")
}

model PayrollComponent {
  id        String  @id @default(cuid())
  payrollId String
  name      String  
  type      String  // EARNING, DEDUCTION
  amount    Decimal @db.Decimal(18, 2)
  
  payroll   Payroll @relation(fields: [payrollId], references: [id], onDelete: Cascade)

  @@map("payroll_components")
}

// ============================================================================
// 3. ASSET MANAGEMENT
// ============================================================================

model Asset {
  id                   String      @id @default(cuid())
  
  // Identification
  assetTag             String      @unique 
  name                 String
  category             String      
  description          String?     @db.Text
  serialNumber         String?     @unique
  
  // Acquisition
  purchaseDate         DateTime
  purchaseCost         Decimal     @db.Decimal(18, 2)
  vendor               String?     
  supplierId           String?     
  
  // Warranty
  warrantyStart        DateTime?
  warrantyEnd          DateTime?
  warrantyPeriodMonths Int?
  
  // State & Location
  status               AssetStatus @default(ACTIVE)
  condition            String?     
  location             String?
  department           String?
  
  // Assignment (Who has it?)
  assignedToEmployeeId String?
  
  // Maintenance Tracking
  lastMaintenance      DateTime?
  nextMaintenance      DateTime?
  
  // Disposal Logic
  disposed             Boolean     @default(false)
  disposalDate         DateTime?
  disposalReason       String?     @db.Text
  
  createdAt            DateTime    @default(now())
  updatedAt            DateTime    @updatedAt

  // RELATIONS
  assignedTo           Employee?          @relation(fields: [assignedToEmployeeId], references: [id])
  supplier             Supplier?          @relation(fields: [supplierId], references: [id])
  maintenanceRecords   AssetMaintenance[]

  @@map("assets")
}

model AssetMaintenance {
  id              String   @id @default(cuid())
  assetId         String
  maintenanceDate DateTime
  description     String   @db.Text
  cost            Decimal  @db.Decimal(18, 2)
  performedBy     String?
  createdAt       DateTime @default(now())
  
  asset           Asset    @relation(fields: [assetId], references: [id], onDelete: Cascade)

  @@map("asset_maintenances")
}

// ============================================================================
// 4. PRODUCTION & INVENTORY
// ============================================================================

model ProductCategory {
  id          String    @id @default(cuid())
  name        String    @unique 
  description String?   @db.Text
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  products    Product[]

  @@map("product_categories")
}

model Product {
  id           String      @id @default(cuid())
  code         String      @unique 
  sku          String?     
  name         String
  type         ProductType @default(FINISHED_GOOD)
  brand        String?
  description  String?
  
  // Link to Dynamic Category
  categoryId   String?     
  category     ProductCategory? @relation(fields: [categoryId], references: [id])

  // Link to Supplier
  supplierId   String?
  supplier     Supplier?        @relation(fields: [supplierId], references: [id])

  // Inventory
  stockOnHand  Int         @default(0)
  reorderLevel Int         @default(10)
  
  // Financials
  costPrice    Decimal     @db.Decimal(18, 2)
  sellingPrice Decimal     @db.Decimal(18, 2)
  
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt

  // RELATIONS
  inventoryMovements InventoryMovement[]
  invoiceItems       SalesInvoiceItem[]
  poItems            PurchaseOrderItem[]
  productionReports  ProductionReport[]
  proformaItems      ProformaInvoiceItem[]
  
  // BOM
  bomParent          BillOfMaterial[]    @relation("BOMParent")
  bomChild           BillOfMaterial[]    @relation("BOMComponent")
  
  productionOrders   ProductionOrder[]

  @@map("products")
}

model BillOfMaterial {
  id          String  @id @default(cuid())
  parentId    String  
  componentId String  
  quantity    Decimal @db.Decimal(12, 4) 
  
  parent      Product @relation("BOMParent", fields: [parentId], references: [id])
  component   Product @relation("BOMComponent", fields: [componentId], references: [id])

  @@unique([parentId, componentId])
  @@map("bill_of_materials")
}

model InventoryMovement {
  id          String   @id @default(cuid())
  productId   String
  type        String   
  quantity    Int      
  referenceId String?  
  date        DateTime @default(now())
  
  product     Product  @relation(fields: [productId], references: [id])

  @@index([productId, date])
  @@map("inventory_movements")
}

model ProductionReport {
  id           String   @id @default(cuid())
  batchNumber  String   @unique
  date         DateTime
  shift        String   
  
  productId    String   
  totalQty     Int
  qualifiedQty Int
  rejectedQty  Int      @default(0)
  
  // Detailed Reporting
  rawMaterialsUsed Json?   
  staffId          String? 
  
  notes        String?  @db.Text
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  product      Product            @relation(fields: [productId], references: [id])
  staff        User?              @relation("ReportCreator", fields: [staffId], references: [id])
  defects      ProductionDefect[]

  @@map("production_reports")
}

model ProductionDefect {
  id                 String @id @default(cuid())
  productionReportId String
  defectType         String 
  quantity           Int
  
  productionReport   ProductionReport @relation(fields: [productionReportId], references: [id], onDelete: Cascade)

  @@map("production_defects")
}

// ============================================================================
// 5. SALES, CUSTOMERS & DEBTORS
// ============================================================================

model Customer {
  id             String   @id @default(cuid())
  name           String
  code           String?  @unique
  email          String?
  phone          String?
  address        String?  @db.Text
  
  currentBalance Decimal  @db.Decimal(18, 2) @default(0) 
  creditLimit    Decimal? @db.Decimal(18, 2)
  
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  invoices       SalesInvoice[]
  payments       CustomerPayment[]
  proformas      ProformaInvoice[]

  @@map("customers")
}

model CustomerPayment {
  id            String        @id @default(cuid())
  paymentNumber String        @unique
  customerId    String
  date          DateTime      @default(now())
  
  amount        Decimal       @db.Decimal(18, 2) 
  unusedAmount  Decimal       @db.Decimal(18, 2) 
  
  method        PaymentMethod
  reference     String?       
  currencyId    String

  customer      Customer             @relation(fields: [customerId], references: [id])
  currency      Currency             @relation(fields: [currencyId], references: [id])
  applications  PaymentApplication[] 

  @@map("customer_payments")
}

model PaymentApplication {
  id            String   @id @default(cuid())
  paymentId     String
  invoiceId     String
  amountApplied Decimal  @db.Decimal(18, 2)
  appliedAt     DateTime @default(now())

  payment       CustomerPayment @relation(fields: [paymentId], references: [id])
  invoice       SalesInvoice    @relation(fields: [invoiceId], references: [id])

  @@map("payment_applications")
}

// ============================================================================
// 6. PURCHASING & SUPPLIERS
// ============================================================================

model Supplier {
  id             String   @id @default(cuid())
  name           String
  email          String?
  phone          String?
  balance        Decimal  @db.Decimal(18, 2) @default(0)
  
  createdAt      DateTime @default(now())
  
  purchaseOrders PurchaseOrder[]
  assets         Asset[]
  expenses       Expense[]
  
  // Supplier Relations
  payments       SupplierPayment[]
  products       Product[]

  @@map("suppliers")
}

model SupplierPayment {
  id            String         @id @default(cuid())
  paymentNumber String         @unique 
  supplierId    String
  date          DateTime       @default(now())
  
  amount        Decimal        @db.Decimal(18, 2)
  
  method        PaymentMethod
  reference     String?        
  currencyId    String
  
  // NEW: Link to PO
  purchaseOrderId String?
  purchaseOrder   PurchaseOrder? @relation(fields: [purchaseOrderId], references: [id])
  
  notes         String?        @db.Text
  
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  supplier      Supplier       @relation(fields: [supplierId], references: [id])
  currency      Currency       @relation(fields: [currencyId], references: [id])
  
  // Implicit relation to items (left as requested)
  purchaseOrderItems PurchaseOrderItem[]

  @@map("supplier_payments")
}

model PurchaseOrder {
  id          String   @id @default(cuid())
  poNumber    String   @unique
  supplierId  String
  date        DateTime @default(now())
  status      String   @default("DRAFT")

  // --- NEW FIELDS ---
  paidAmount    Decimal   @db.Decimal(18, 2) @default(0)
  paymentStatus String    @default("UNPAID") // UNPAID, PARTIAL, PAID
  
  totalAmount Decimal  @db.Decimal(18, 2)
  createdById String
  
  // --- RELATIONS ---
  supplier    Supplier            @relation(fields: [supplierId], references: [id])
  creator     User                @relation("POCreator", fields: [createdById], references: [id])
  items       PurchaseOrderItem[]
  payments    SupplierPayment[]

  @@map("purchase_orders")
}

model PurchaseOrderItem {
  id              String  @id @default(cuid())
  purchaseOrderId String
  productId       String
  quantity        Int
  unitCost        Decimal @db.Decimal(18, 2)
  total           Decimal @db.Decimal(18, 2)
  
  paidAmount    Decimal   @db.Decimal(18, 2) @default(0)
  paymentStatus String    @default("UNPAID")

  // Link to Payments
  payments      SupplierPayment[]

  purchaseOrder   PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)
  product         Product       @relation(fields: [productId], references: [id])

  @@map("purchase_order_items")
}

// ============================================================================
// 7. EXPENSE TRACKING
// ============================================================================

model Expense {
  id                String               @id @default(cuid())
  
  expenseCode       String               @unique 
  title             String
  description       String?              @db.Text
  category          String               
  
  amount            Decimal              @db.Decimal(18, 2)
  currencyId        String
  paymentMethod     ExpensePaymentMethod
  
  vendor            String?              
  supplierId        String?              
  
  incurredDate      DateTime
  department        String?
  project           String?
  
  status            ExpenseStatus        @default(PENDING)
  approvedById      String?              
  
  attachmentUrl     String?              
  
  recurring         Boolean              @default(false)
  recurringInterval RecurringInterval?
  
  notes             String?              @db.Text
  createdAt         DateTime             @default(now())
  updatedAt         DateTime             @updatedAt

  currency          Currency       @relation(fields: [currencyId], references: [id])
  approvedBy        User?          @relation("ExpenseApprover", fields: [approvedById], references: [id])
  supplier          Supplier?      @relation(fields: [supplierId], references: [id])
  
  journalEntryId    String?        @unique
  journalEntry      JournalEntry?  @relation(fields: [journalEntryId], references: [id])

  @@map("expenses")
}

// ============================================================================
// 8. ACCOUNTING (General Ledger)
// ============================================================================

model ChartOfAccount {
  id              String   @id @default(cuid())
  code            String   @unique 
  name            String   
  type            AccountType
  isSystemAccount Boolean  @default(false) 
  
  entries         JournalEntryLine[]

  @@map("chart_of_accounts")
}

model JournalEntry {
  id           String   @id @default(cuid())
  entryNumber  String   @unique
  date         DateTime
  description  String?
  reference    String?  
  posted       Boolean  @default(false)
  createdById  String?
  
  createdAt    DateTime @default(now())

  creator      User?              @relation("EntryCreator", fields: [createdById], references: [id])
  lines        JournalEntryLine[]
  
  salesInvoice SalesInvoice?
  expense      Expense?

  @@map("journal_entries")
}

model JournalEntryLine {
  id             String  @id @default(cuid())
  journalEntryId String
  accountId      String
  
  debit          Decimal @db.Decimal(18, 2) @default(0)
  credit         Decimal @db.Decimal(18, 2) @default(0)
  
  account        ChartOfAccount @relation(fields: [accountId], references: [id])
  journalEntry   JournalEntry   @relation(fields: [journalEntryId], references: [id], onDelete: Cascade)

  @@map("journal_entry_lines")
}

// ============================================================================
// 9. SALES INVOICING & PROFORMA
// ============================================================================

model SalesInvoice {
  id              String        @id @default(cuid())
  invoiceNumber   String?       @unique
  customerId      String
  date            DateTime
  dueDate         DateTime
  
  destination     String?       
  loadingLocation String?       @default("Enugu KVTS Industries") 
  
  currencyId      String
  exchangeRate    Decimal       @db.Decimal(18, 6) @default(1)

  isPosted        Boolean       @default(false) 

  status          InvoiceStatus @default(DRAFT)
  
  // Tax & Logistics
  subTotal        Decimal       @db.Decimal(18, 2) @default(0)
  taxRate         Decimal       @db.Decimal(5, 2)  @default(0) 
  taxAmount       Decimal       @db.Decimal(18, 2) @default(0)
  logisticsFee    Decimal       @db.Decimal(18, 2) @default(0)
  
  totalAmount     Decimal       @db.Decimal(18, 2)
  paidAmount      Decimal       @db.Decimal(18, 2) @default(0)
  balanceDue      Decimal       @db.Decimal(18, 2)
  
  notes           String?
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  customer        Customer             @relation(fields: [customerId], references: [id])
  currency        Currency             @relation(fields: [currencyId], references: [id])
  items           SalesInvoiceItem[]
  payments        PaymentApplication[]
  journalEntryId  String?              @unique
  journalEntry    JournalEntry?        @relation(fields: [journalEntryId], references: [id])
  
  fromProformaId  String?
  fromProforma    ProformaInvoice?     @relation(fields: [fromProformaId], references: [id])

  waybill         Waybill?

  @@map("sales_invoices")
}

model SalesInvoiceItem {
  id        String  @id @default(cuid())
  invoiceId String
  productId String
  
  packageType String? 

  quantity  Int
  unitPrice Decimal @db.Decimal(18, 2)
  total     Decimal @db.Decimal(18, 2)
  taxAmount Decimal @db.Decimal(18, 2) @default(0)

  invoice   SalesInvoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  product   Product      @relation(fields: [productId], references: [id])

  @@map("sales_invoice_items")
}

model Waybill {
  id              String       @id @default(cuid())
  salesInvoiceId  String       @unique

  waybillNumber   String       @unique 
  gatePassCode    String?      
  
  dispatchDate    DateTime     @default(now())
  
  vehicleNumber   String?
  driverName      String?
  driverPhone     String?
  
  preparedBy      String?      
  securityCheckBy String?      
  
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  salesInvoice    SalesInvoice @relation(fields: [salesInvoiceId], references: [id], onDelete: Cascade)

  @@map("waybills")
}

model ProformaInvoice {
  id              String         @id @default(cuid())
  proformaNumber  String         @unique
  customerId      String
  date            DateTime       @default(now())
  expiryDate      DateTime?
  
  currencyId      String
  
  subTotal        Decimal        @db.Decimal(18, 2) @default(0)
  taxAmount       Decimal        @db.Decimal(18, 2) @default(0)
  totalAmount     Decimal        @db.Decimal(18, 2)
  
  status          ProformaStatus @default(DRAFT)
  notes           String?        @db.Text
  
  createdById     String
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  customer        Customer              @relation(fields: [customerId], references: [id])
  currency        Currency              @relation(fields: [currencyId], references: [id])
  creator         User                  @relation("ProformaCreator", fields: [createdById], references: [id])
  items           ProformaInvoiceItem[]
  
  convertedInvoices SalesInvoice[]

  @@map("proforma_invoices")
}

model ProformaInvoiceItem {
  id                String          @id @default(cuid())
  proformaInvoiceId String
  productId         String
  
  description       String?         
  quantity          Int
  unitPrice         Decimal         @db.Decimal(18, 2)
  total             Decimal         @db.Decimal(18, 2)

  proformaInvoice   ProformaInvoice @relation(fields: [proformaInvoiceId], references: [id], onDelete: Cascade)
  product           Product         @relation(fields: [productId], references: [id])

  @@map("proforma_invoice_items")
}

// ============================================================================
// 10. SYSTEM & UTIL
// ============================================================================

model SystemSetting {
  id              String   @id @default(cuid())
  
  companyName     String   @default("KVTS INDUSTRIES CO., LTD.")
  companyAddress  String   @db.Text
  companyPhone    String?
  companyEmail    String?
  
  defaultTaxRate  Decimal  @db.Decimal(5, 2) @default(7.5) 
  currencySymbol  String   @default("â‚¦")
  
  updatedAt       DateTime @updatedAt

  @@map("system_settings")
}

model Announcement {
  id          String   @id @default(cuid())
  title       String
  message     String   @db.Text
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  createdById String
  createdBy   User     @relation(fields: [createdById], references: [id])

  @@map("announcements")
}

enum OrderStatus {
  DRAFT
  PLANNED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

model ProductionOrder {
  id            String      @id @default(cuid())
  orderNumber   String      @unique 
  
  productId     String
  product       Product     @relation(fields: [productId], references: [id])
  
  quantity      Int         
  producedQty   Int         @default(0) 
  
  status        OrderStatus @default(DRAFT)
  priority      String      @default("NORMAL") 
  
  startDate     DateTime    @default(now())
  dueDate       DateTime?
  
  notes         String?     @db.Text
  
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  @@map("production_orders")
}